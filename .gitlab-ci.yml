  stages:
    - build
    - deploy

  build:
    stage: build
    image: maven:3.8.6-openjdk-21
    script:
      - mvn clean package
    artifacts:
      paths:
        - target/*.jar

  deploy:
    stage: deploy
    image: ubuntu:latest
    script:
      - apt-get update && apt-get install -y curl
      - curl -fsSL https://railway.app/install.sh | sh
      - railway login --token $RAILWAY_TOKEN
      - railway up
    only:
      - main